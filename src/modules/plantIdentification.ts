import { Composer, Markup } from 'telegraf';

export const plantIdentificationModule = new Composer();

// Handle plant identification command
plantIdentificationModule.command('identify', async (ctx) => {
  await ctx.reply(
    'Пожалуйста, отправьте фотографию растения, которое хотите идентифицировать. ' +
    'Для лучшего результата сделайте четкое фото при хорошем освещении.\n\n' +
    'Вы можете добавить описание к фото или использовать следующие ключевые слова в подписи:\n' +
    '- "идентификация" - для определения растения и получения информации о нем\n' +
    '- "проблема", "болезнь" или "вредитель" - для диагностики проблем растения'
  );
});

// Handle plant questions after identification
plantIdentificationModule.hears('Витамины и микроэлементы', async (ctx) => {
  const message = `
*Витамины и микроэлементы для растений*

Основные питательные элементы:

Азот (N):
- Необходим для роста листьев и стеблей
- Источники: кофейная гуща, компост, перегнившие листья

Фосфор (P):
- Способствует развитию корней и цветению
- Источники: банановая кожура, костная мука, яичная скорлупа

Калий (K):
- Улучшает иммунитет растений и качество плодов
- Источники: банановая кожура, древесная зола, водоросли

Кальций (Ca):
- Укрепляет клеточные стенки
- Источники: яичная скорлупа, доломитовая мука

Магний (Mg):
- Участвует в фотосинтезе
- Источники: эпсомская соль, компост

Железо (Fe):
- Необходимо для образования хлорофилла
- Источники: ржавые гвозди в воде, компост

Признаки дефицита:
- Азот: пожелтение нижних листьев
- Фосфор: тёмно-зелёные листья с пурпурным оттенком
- Калий: пожелтение и отмирание краёв листьев
- Магний: пожелтение между жилками листьев
- Железо: пожелтение между жилками молодых листьев
`;

  await ctx.replyWithMarkdownV2(message.replace(/\-/g, '\\-'));
});

plantIdentificationModule.hears('Уход за растением', async (ctx) => {
  const message = `
*Общие принципы ухода за комнатными растениями*

Полив:
- Большинство растений предпочитают просыхание верхнего слоя почвы между поливами
- Используйте отстоянную воду комнатной температуры
- Кактусы и суккуленты поливают редко, тропические растения чаще
- Избегайте переувлажнения и застоя воды

Освещение:
- Светолюбивые: не менее 6 часов прямого солнца (суккуленты, цитрусовые)
- Полутень: яркий рассеянный свет (большинство цветущих растений)
- Теневыносливые: могут расти при минимальном освещении (папоротники, некоторые виды фикусов)

Температура:
- Большинство комнатных растений комфортно чувствуют себя при 18-24°C
- Избегайте резких перепадов температуры
- Защищайте от сквозняков и потоков холодного воздуха

Влажность:
- Тропические растения предпочитают высокую влажность
- Регулярно опрыскивайте листья или используйте увлажнитель воздуха
- Группируйте растения для повышения влажности

Подкормки:
- В период активного роста (весна-лето) подкармливайте каждые 2-4 недели
- Зимой большинство растений в подкормке не нуждаются
- Используйте органические удобрения (компост, настои) или специализированные минеральные
`;

  await ctx.replyWithMarkdownV2(message.replace(/\-/g, '\\-'));
}); 