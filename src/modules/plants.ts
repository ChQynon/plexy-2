import { Composer, Markup } from 'telegraf';

export const plantsModule = new Composer();

// Handle /plants command
plantsModule.command('plants', async (ctx) => {
  await ctx.reply(
    'Выберите раздел об уходе за растениями:',
    Markup.keyboard([
      ['Удобрения из отходов', 'Типичные проблемы'],
      ['Полив и освещение', 'Пересадка'],
      ['Борьба с вредителями', 'Назад в главное меню']
    ]).resize()
  );
});

// Handle plants keyboard options
plantsModule.hears('Удобрения из отходов', async (ctx) => {
  const message = `
*Удобрения из бытовых отходов*

Кофейная гуща:
- Богата азотом, калием и фосфором
- Отпугивает вредителей
- Способствует росту и развитию растений
- Применение: посыпать почву или добавить в компост

Яичная скорлупа:
- Источник кальция и микроэлементов
- Улучшает структуру почвы
- Применение: измельчить, смешать с почвой или настоять в воде

Банановая кожура:
- Богата калием, фосфором и кальцием
- Стимулирует цветение
- Применение: закопать возле корней или настоять в воде

Чайная заварка:
- Содержит дубильные вещества и минералы
- Улучшает структуру почвы
- Применение: добавить в почву или полить настоем

Картофельная вода:
- Содержит крахмал и минералы
- Источник питательных веществ
- Применение: остывшей водой после варки полить растения
`;
  
  await ctx.replyWithMarkdownV2(message.replace(/\-/g, '\\-'));
});

plantsModule.hears('Типичные проблемы', async (ctx) => {
  const message = `
*Типичные проблемы комнатных растений*

Желтеющие листья:
- Причины: переувлажнение, недостаток света, нехватка питательных веществ
- Решение: скорректировать полив, обеспечить освещение, подкормить

Коричневые кончики листьев:
- Причины: сухой воздух, избыток удобрений, хлор в воде
- Решение: увлажнять воздух, сократить подкормки, использовать отстоянную воду

Вытягивание стеблей:
- Причины: недостаток света
- Решение: переставить растение в более освещенное место, обеспечить равномерное освещение

Опадение листьев:
- Причины: стресс при смене условий, сквозняки, переувлажнение
- Решение: стабилизировать условия содержания, избегать резких перепадов температуры

Отсутствие цветения:
- Причины: недостаток света, неправильный уход, нехватка питательных веществ
- Решение: обеспечить достаточное освещение, подкормить фосфорно-калийными удобрениями
`;
  
  await ctx.replyWithMarkdownV2(message.replace(/\-/g, '\\-'));
});

plantsModule.hears('Полив и освещение', async (ctx) => {
  const message = `
*Полив и освещение растений*

Правила полива:
- Поливайте по мере подсыхания верхнего слоя почвы
- Учитывайте сезон: летом чаще, зимой реже
- Используйте отстоянную воду комнатной температуры
- Избегайте застоя воды в поддоне
- Для тропических растений полезен регулярный опрыскиватель

Освещение:
- Светолюбивые растения: прямой солнечный свет минимум 6 часов в день
- Растения средней освещенности: яркий рассеянный свет
- Теневыносливые: могут расти при минимальном освещении
- Зимой многим растениям требуется дополнительное освещение
- Поворачивайте растения для равномерного роста
`;
  
  await ctx.replyWithMarkdownV2(message.replace(/\-/g, '\\-'));
});

plantsModule.hears('Пересадка', async (ctx) => {
  const message = `
*Пересадка комнатных растений*

Когда пересаживать:
- Когда корни оплетают земляной ком и выглядывают из дренажных отверстий
- Когда растение перестало расти или выглядит угнетенным
- В среднем молодые растения пересаживают раз в год, взрослые - раз в 2-3 года

Как пересаживать:
- Выбирайте горшок на 2-3 см больше предыдущего в диаметре
- Используйте подходящий грунт для конкретного растения
- Обеспечьте хороший дренаж (керамзит, битый кирпич)
- После пересадки умеренно полейте и поставьте в полутень на 1-2 недели

Лучшее время для пересадки:
- Весна (март-апрель) - начало активного роста
- Избегайте пересадки в период цветения и зимнего покоя
`;
  
  await ctx.replyWithMarkdownV2(message.replace(/\-/g, '\\-'));
});

plantsModule.hears('Борьба с вредителями', async (ctx) => {
  const message = `
*Борьба с вредителями естественными способами*

Тля:
- Мыльный раствор (1 столовая ложка жидкого мыла на 1 литр воды)
- Настой чеснока (5-6 зубчиков на 1 литр воды, настоять сутки)
- Опрыскивание раз в 3-4 дня до исчезновения

Паутинный клещ:
- Повышение влажности воздуха
- Раствор настоя луковой шелухи (100 г на 1 литр воды, кипятить 15 минут)
- Опрыскивание нижней стороны листьев

Щитовка и ложнощитовка:
- Механическое удаление ватной палочкой, смоченной в спирте
- Масляная эмульсия (2 столовые ложки растительного масла + 1 чайная ложка жидкого мыла на 1 литр воды)

Мучнистый червец:
- Протирание листьев спиртовым раствором
- Опрыскивание настоем табака (50 г на 1 литр воды)

Профилактика:
- Регулярный осмотр растений
- Карантин для новых растений
- Поддержание оптимальной влажности
- Здоровая почва и правильный уход
`;
  
  await ctx.replyWithMarkdownV2(message.replace(/\-/g, '\\-'));
});

plantsModule.hears('Назад в главное меню', async (ctx) => {
  await ctx.reply(
    'Вы вернулись в главное меню. Выберите интересующий вас раздел или задайте вопрос:',
    Markup.keyboard([
      ['/vitamins', '/plants'],
      ['/help']
    ]).resize()
  );
}); 